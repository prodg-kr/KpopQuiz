<!DOCTYPE html>

<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>K-pop Quiz Game - ë‹¹ì‹ ì€ K-pop ë§ˆìŠ¤í„°ì¸ê°€ìš”?</title>
  <meta name="description" content="BTS, BLACKPINK, NewJeans ë“± K-pop ì•„í‹°ìŠ¤íŠ¸ì— ëŒ€í•œ ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”! ì¬ë¯¸ìˆëŠ” K-pop í€´ì¦ˆ ê²Œì„.">
  <meta name="keywords" content="K-pop, í€´ì¦ˆ, BTS, BLACKPINK, NewJeans, ì¼€ì´íŒ, ê²Œì„">

  <meta property="og:type" content="website">
  <meta property="og:title" content="K-pop Quiz Game">
  <meta property="og:description" content="ë‹¹ì‹ ì˜ K-pop ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!">

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤</text></svg>">

  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --accent: #7c5cff;
      --accent-2: #ff5c9a;
      --text: #e9e9f1;
      --muted: #a9a9c7;
      --correct: #2ecc71;
      --wrong: #e74c3c;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 600px at 20% 20%, #1b1f36 0%, var(--bg) 60%);
      color: var(--text);
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      padding: 20px 10px;
    }

    .container {
      width: min(720px, 100%);
      background: linear-gradient(180deg, rgba(124, 92, 255, 0.08), rgba(255, 92, 154, 0.08)), var(--card);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      position: relative;
      overflow: hidden;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .title {
      font-weight: 700;
      letter-spacing: 0.2px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
    }

    .title .badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(124, 92, 255, 0.18);
      color: #d9d6ff;
      border: 1px solid rgba(124, 92, 255, 0.35);
    }

    .meta {
      display: flex;
      gap: 10px;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      white-space: nowrap;
    }

    .difficulty-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 10px;
    }

    .difficulty-btn {
      flex: 1;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      cursor: pointer;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .difficulty-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-1px);
    }

    .difficulty-btn.active {
      background: linear-gradient(180deg, rgba(124, 92, 255, 0.3), rgba(124, 92, 255, 0.2));
      border-color: var(--accent);
      color: #d9d6ff;
    }

    .question-card {
      margin-top: 8px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 18px;
    }

    .category-badge {
      display: inline-block;
      padding: 4px 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .category-artist {
      background: rgba(255, 92, 154, 0.2);
      color: #ffadd2;
    }

    .category-song {
      background: rgba(124, 92, 255, 0.2);
      color: #c9b3ff;
    }

    .category-album {
      background: rgba(46, 204, 113, 0.2);
      color: #7cf5b8;
    }

    .category-general {
      background: rgba(52, 152, 219, 0.2);
      color: #85d7ff;
    }

    .question {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .option {
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      cursor: pointer;
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-family: inherit;
    }

    .option:hover:not(.disabled) {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.1);
    }

    .option:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .option.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    .option.correct {
      background: rgba(46, 204, 113, 0.15);
      border-color: rgba(46, 204, 113, 0.6);
      animation: correctPulse 0.5s ease;
    }

    .option.wrong {
      background: rgba(231, 76, 60, 0.15);
      border-color: rgba(231, 76, 60, 0.6);
      animation: shake 0.5s ease;
    }

    @keyframes correctPulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.02);
      }
    }

    @keyframes shake {
      0%, 100% {
        transform: translateX(0);
      }
      25% {
        transform: translateX(-5px);
      }
      75% {
        transform: translateX(5px);
      }
    }

    .option-label {
      font-weight: 600;
      min-width: 24px;
    }

    .feedback {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.5;
      display: none;
    }

    .feedback.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .feedback.correct {
      background: rgba(46, 204, 113, 0.1);
      border: 1px solid rgba(46, 204, 113, 0.3);
      color: #5ce8a8;
    }

    .feedback.wrong {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      color: #ff8c82;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      gap: 10px;
    }

    .progress {
      height: 8px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .reset-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: rgba(124, 92, 255, 0.15);
      color: #d9d6ff;
      cursor: pointer;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .reset-btn:hover {
      background: rgba(124, 92, 255, 0.25);
      transform: translateY(-1px);
    }

    .end-screen {
      text-align: center;
      display: none;
    }

    .end-screen.show {
      display: block;
    }

    .final-score {
      font-size: 48px;
      font-weight: 700;
      margin: 20px 0;
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .score-message {
      font-size: 18px;
      color: var(--muted);
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 16px;
      }
      .title {
        font-size: 18px;
      }
      .question {
        font-size: 18px;
      }
      .option {
        font-size: 14px;
        padding: 10px 12px;
      }
      .difficulty-selector {
        flex-wrap: wrap;
      }
      .difficulty-btn {
        flex: 1 1 calc(50% - 4px);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="title">
        ğŸ¤ K-pop Quiz
        <span class="badge">2026</span>
      </div>
      <div class="meta">
        <span class="pill" id="category">ì „ì²´</span>
        <span class="pill" id="difficulty">ëª¨ë“  ë‚œì´ë„</span>
      </div>
    </div>

    <div class="difficulty-selector">
      <button class="difficulty-btn active" data-difficulty="all">ëª¨ë‘</button>
      <button class="difficulty-btn" data-difficulty="easy">ì‰¬ì›€</button>
      <button class="difficulty-btn" data-difficulty="medium">ì¤‘ê°„</button>
      <button class="difficulty-btn" data-difficulty="hard">ì–´ë ¤ì›€</button>
    </div>

    <div id="quiz-container">
      <div class="question-card">
        <span class="category-badge" id="category-badge">artist</span>
        <div class="question" id="question">ë¡œë”© ì¤‘...</div>
        <div class="options" id="options">
          <div class="option disabled">ë¡œë”© ì¤‘...</div>
        </div>
        <div class="feedback" id="feedback"></div>
        <div class="footer">
          <span id="question-number">1/100</span>
          <button class="reset-btn" id="next-btn">ë‹¤ìŒ â†’</button>
        </div>
        <div class="progress">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>
    </div>

    <div class="end-screen" id="end-screen">
      <h2>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ!</h2>
      <div class="final-score" id="final-score">0/100</div>
      <div class="score-message" id="score-message">ì •ë‹µì„ ë§ì¶°ë³´ì„¸ìš”!</div>
      <button class="reset-btn" id="restart-btn">ë‹¤ì‹œ ì‹œì‘ â†»</button>
    </div>
  </div>

  <script>
    const quizContainer = document.getElementById('quiz-container');
    const endScreen = document.getElementById('end-screen');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    const questionNumberEl = document.getElementById('question-number');
    const progressBar = document.getElementById('progress-bar');
    const categoryEl = document.getElementById('category');
    const difficultyEl = document.getElementById('difficulty');
    const categoryBadge = document.getElementById('category-badge');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    const finalScoreEl = document.getElementById('final-score');
    const scoreMessageEl = document.getElementById('score-message');

    let quizData = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let selectedDifficulty = 'all';
    let answered = false;
    let filteredQuestions = [];

    // API ì„œë²„ URL ì„¤ì • (ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ ìë™ ê°ì§€)
    const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:5000'
      : window.location.origin;

    // ë°ì´í„° ë¡œë“œ
    async function loadQuizData() {
      try {
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        questionEl.textContent = 'ğŸ“‚ ë°ì´í„° ë¡œë“œ ì¤‘...';
        
        // APIì—ì„œ í€´ì¦ˆ ë°ì´í„° ë¡œë“œ (100ê°œ ë¬¸ì œ)
        const response = await fetch(`${API_URL}/api/quiz?limit=100&random=true`);
        if (!response.ok) {
          throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
        }
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'API ì‘ë‹µ ì˜¤ë¥˜');
        }
        
        quizData = result.data || [];
        
        if (quizData.length === 0) {
          throw new Error('ì§ˆë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        console.log(`âœ… ${quizData.length}ê°œ ë¬¸ì œ ë¡œë“œ ì™„ë£Œ`);
        filterQuestions();
        displayQuestion();
      } catch (error) {
        console.error('âŒ í€´ì¦ˆ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        questionEl.innerHTML = `
          <div style="text-align: center; padding: 30px; color: var(--wrong);">
            <h2>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h2>
            <p>${error.message}</p>
            <p style="font-size: 14px; margin-top: 15px;">
              ë¡œì»¬ ì„œë²„ ì‹¤í–‰: python run_server.py<br>
              ë˜ëŠ” ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12)ë¥¼ ì—´ì–´ ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
            </p>
          </div>
        `;
      }
    }

    // ë‚œì´ë„ í•„í„°ë§
    function filterQuestions() {
      if (selectedDifficulty === 'all') {
        filteredQuestions = [...quizData];
        difficultyEl.textContent = 'ëª¨ë“  ë‚œì´ë„';
      } else {
        filteredQuestions = quizData.filter(q => q.difficulty === selectedDifficulty);
        const difficultyNames = {
          'easy': 'ì‰¬ì›€',
          'medium': 'ì¤‘ê°„',
          'hard': 'ì–´ë ¤ì›€'
        };
        difficultyEl.textContent = difficultyNames[selectedDifficulty];
      }
      currentQuestionIndex = 0;
      score = 0;
      answered = false;
    }

    // ë‚œì´ë„ ë²„íŠ¼ ì´ë²¤íŠ¸
    difficultyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        difficultyBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedDifficulty = btn.dataset.difficulty;
        filterQuestions();
        displayQuestion();
      });
    });

    // ì§ˆë¬¸ í‘œì‹œ
    function displayQuestion() {
      if (currentQuestionIndex >= filteredQuestions.length) {
        showEndScreen();
        return;
      }

      answered = false;
      const question = filteredQuestions[currentQuestionIndex];
      
      questionEl.textContent = question.question;
      categoryBadge.textContent = question.category || 'artist';
      categoryBadge.className = `category-badge category-${question.category || 'artist'}`;
      
      optionsEl.innerHTML = '';
      
      // APIì—ì„œ ì˜¨ optionsëŠ” {id, option_text, order_num, is_correct} í˜•ì‹
      // ì •ë‹µ ì¸ë±ìŠ¤ë¥¼ ì°¾ê¸°
      let correctOptionIndex = -1;
      const sortedOptions = question.options.sort((a, b) => a.order_num - b.order_num);
      sortedOptions.forEach((option, index) => {
        if (option.is_correct) {
          correctOptionIndex = index;
        }
      });
      
      sortedOptions.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.innerHTML = `<span class="option-label">${String.fromCharCode(65 + index)}.</span>${option.option_text}`;
        btn.dataset.optionId = option.id;
        btn.addEventListener('click', () => checkAnswer(index, correctOptionIndex, option.id));
        optionsEl.appendChild(btn);
      });

      questionNumberEl.textContent = `${currentQuestionIndex + 1}/${filteredQuestions.length}`;
      const progressPercent = ((currentQuestionIndex + 1) / filteredQuestions.length) * 100;
      progressBar.style.width = progressPercent + '%';
      
      feedbackEl.className = 'feedback';
      feedbackEl.textContent = '';
      nextBtn.textContent = currentQuestionIndex === filteredQuestions.length - 1 ? 'ì™„ë£Œ âœ“' : 'ë‹¤ìŒ â†’';
      nextBtn.disabled = false;
    }

    // ë‹µë³€ í™•ì¸ (ë¹„ë™ê¸°ë¡œ APIì™€ ê²€ì¦)
    async function checkAnswer(selectedIndex, correctIndex, optionId) {
      if (answered) return;
      
      answered = true;
      const question = filteredQuestions[currentQuestionIndex];
      const isCorrect = selectedIndex === correctIndex;
      
      // UI ì—…ë°ì´íŠ¸
      const options = document.querySelectorAll('.option');
      options.forEach((option, index) => {
        option.classList.add('disabled');
        if (index === correctIndex) {
          option.classList.add('correct');
        }
        if (index === selectedIndex && !isCorrect) {
          option.classList.add('wrong');
        }
      });

      try {
        // APIì—ì„œ ë‹µë³€ ê²€ì¦ (ì„ íƒì‚¬í•­ - ì„œë²„ì—ì„œ ì¬í™•ì¸)
        const response = await fetch(`${API_URL}/api/quiz/${question.id}/check`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ selected_option_id: optionId })
        });
        
        if (response.ok) {
          const result = await response.json();
          // ì„œë²„ ê²°ê³¼ë¡œ ìµœì¢… íŒì •
          if (isCorrect || result.is_correct) {
            score++;
            feedbackEl.className = 'feedback show correct';
            feedbackEl.textContent = 'âœ“ ì •ë‹µì…ë‹ˆë‹¤! ' + (question.explanation || '');
          } else {
            feedbackEl.className = 'feedback show wrong';
            feedbackEl.textContent = 'âœ— í‹€ë ¸ìŠµë‹ˆë‹¤. ' + (question.explanation || '');
          }
        }
      } catch (error) {
        console.warn('ë‹µë³€ ê²€ì¦ API í˜¸ì¶œ ì‹¤íŒ¨, ë¡œì»¬ ê²€ì¦ ì‚¬ìš©:', error);
        if (isCorrect) {
          score++;
          feedbackEl.className = 'feedback show correct';
          feedbackEl.textContent = 'âœ“ ì •ë‹µì…ë‹ˆë‹¤! ' + (question.explanation || '');
        } else {
          feedbackEl.className = 'feedback show wrong';
          feedbackEl.textContent = 'âœ— í‹€ë ¸ìŠµë‹ˆë‹¤. ' + (question.explanation || '');
        }
      }
    }

    // ë‹¤ìŒ ë²„íŠ¼
    nextBtn.addEventListener('click', () => {
      currentQuestionIndex++;
      displayQuestion();
    });

    // ì™„ë£Œ í™”ë©´
    function showEndScreen() {
      quizContainer.style.display = 'none';
      endScreen.classList.add('show');
      finalScoreEl.textContent = `${score}/${filteredQuestions.length}`;
      
      const percentage = (score / filteredQuestions.length) * 100;
      if (percentage === 100) {
        scoreMessageEl.textContent = 'ğŸŠ ì™„ë²½í•´ìš”! K-pop ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤!';
      } else if (percentage >= 80) {
        scoreMessageEl.textContent = 'ğŸ‘ í›Œë¥­í•´ìš”! ê±°ì˜ ë§ˆìŠ¤í„° ìˆ˜ì¤€ì…ë‹ˆë‹¤!';
      } else if (percentage >= 60) {
        scoreMessageEl.textContent = 'ğŸ˜Š ì˜í–ˆì–´ìš”! ë” ì•Œì•„ë³´ì„¸ìš”!';
      } else if (percentage >= 40) {
        scoreMessageEl.textContent = 'ğŸ’ª ê³„ì† ë„ì „í•´ë³´ì„¸ìš”!';
      } else {
        scoreMessageEl.textContent = 'ğŸ¯ ì²˜ìŒë¶€í„° ì‹œì‘í•´ë´…ì‹œë‹¤!';
      }
    }

    // ì¬ì‹œì‘ ë²„íŠ¼
    restartBtn.addEventListener('click', () => {
      quizContainer.style.display = 'block';
      endScreen.classList.remove('show');
      currentQuestionIndex = 0;
      score = 0;
      answered = false;
      displayQuestion();
    });

    // ì´ˆê¸°í™”
    loadQuizData();
  </script>
</body>

</html>