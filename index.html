<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>K-pop Quiz Game - ë‹¹ì‹ ì€ K-pop ë§ˆìŠ¤í„°ì¸ê°€ìš”?</title>
  <meta name="description" content="BTS, BLACKPINK, NewJeans ë“± K-pop ì•„í‹°ìŠ¤íŠ¸ì— ëŒ€í•œ ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”! ì¬ë¯¸ìˆëŠ” K-pop í€´ì¦ˆ ê²Œì„.">
  <meta name="keywords" content="K-pop, í€´ì¦ˆ, BTS, BLACKPINK, NewJeans, ì¼€ì´íŒ, ê²Œì„">
  <!-- ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë° ë©”íƒ€íƒœê·¸ ë™ì¼ -->
  <style>
    /* ì´ì „ ë©”ì‹œì§€ì˜ ì „ì²´ CSS ê·¸ëŒ€ë¡œ ìœ ì§€ */
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --accent: #7c5cff;
      --accent-2: #ff5c9a;
      --text: #e9e9f1;
      --muted: #a9a9c7;
      --correct: #2ecc71;
      --wrong: #e74c3c;
    }

    /* ... ê¸°ì¡´ CSS ì „ì²´ ë³µì‚¬ ... */
  </style>
</head>

<body>
  <!-- ê¸°ì¡´ HTML êµ¬ì¡° ê·¸ëŒ€ë¡œ -->
  <div class="container">
    <!-- ê¸°ì¡´ HTML êµ¬ì¡° ë™ì¼ -->
  </div>

  <script>
    // ğŸ”„ ìˆ˜ì •ëœ JavaScript (JSON íŒŒì¼ ë¡œë“œ + 100ë¬¸ì œ ì§€ì›)
    const TOTAL_QUESTIONS = 100;
    const SCORE_PER_QUESTION = 1;
    const PASSING_SCORE_RATIO = 0.5;
    const EXCELLENT_SCORE_RATIO = 0.8;
    const PERFECT_SCORE_RATIO = 1.0;

    let QUESTIONS = [];

    const elements = {
      question: document.getElementById("question"),
      options: document.getElementById("options"),
      nextBtn: document.getElementById("nextBtn"),
      skipBtn: document.getElementById("skipBtn"),
      score: document.getElementById("score"),
      qIndex: document.getElementById("qIndex"),
      progressBar: document.getElementById("progressBar"),
      questionCard: document.getElementById("questionCard"),
      result: document.getElementById("result"),
      finalText: document.getElementById("finalText"),
      restartBtn: document.getElementById("restartBtn")
    };

    let gameState = {
      order: [],
      current: 0,
      score: 0,
      locked: false
    };

    // JSON íŒŒì¼ ë¡œë“œ
    async function loadQuestions() {
      try {
        elements.question.textContent = 'K-pop ë¬¸ì œ ë¡œë”© ì¤‘...';
        const response = await fetch('./questions.json');
        if (!response.ok) throw new Error('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        QUESTIONS = await response.json();

        if (QUESTIONS.length === 0) {
          throw new Error('ë¬¸ì œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
        }

        console.log(`${QUESTIONS.length}ê°œ ë¬¸ì œ ë¡œë“œ ì™„ë£Œ!`);
        init();
      } catch (error) {
        console.error('ë¬¸ì œ DB ë¡œë“œ ì‹¤íŒ¨:', error);
        elements.question.textContent = 'âŒ questions.json íŒŒì¼ì„ ê°™ì€ í´ë”ì— ë„£ì–´ì£¼ì„¸ìš”.';
        elements.options.innerHTML = `
          <div style="text-align:center;padding:20px;color:var(--muted);">
            <p>ğŸ“ <strong>questions.json</strong> íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
            <p>VS Codeì— ìƒˆ íŒŒì¼ â†’ questions.json â†’ ì½”ë“œ ë³µì‚¬ â†’ ì €ì¥</p>
          </div>
        `;
      }
    }

    function shuffle(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function init() {
      gameState = {
        order: shuffle([...Array(Math.min(QUESTIONS.length, TOTAL_QUESTIONS)).keys()]),
        current: 0,
        score: 0,
        locked: false
      };

      elements.result.style.display = "none";
      elements.questionCard.style.display = "block";
      elements.score.textContent = `ì ìˆ˜: 0`;
      elements.qIndex.textContent = `ë¬¸ì œ: 1 / ${gameState.order.length}`;
      updateUI();
      renderQuestion();
    }

    function updateUI() {
      elements.score.textContent = `ì ìˆ˜: ${gameState.score}`;
      elements.qIndex.textContent = `ë¬¸ì œ: ${gameState.current + 1} / ${gameState.order.length}`;

      const progress = ((gameState.current) / gameState.order.length) * 100;
      elements.progressBar.style.width = `${progress}%`;
      elements.progressBar.parentElement.setAttribute('aria-valuenow', Math.round(progress));
    }

    function renderQuestion() {
      elements.nextBtn.disabled = true;
      elements.options.innerHTML = "";
      gameState.locked = false;

      const questionData = QUESTIONS[gameState.order[gameState.current]];
      elements.question.textContent = questionData.question;

      questionData.options.forEach((optionText, idx) => {
        const button = document.createElement("button");
        button.className = "option";
        button.setAttribute('role', 'radio');
        button.setAttribute('aria-checked', 'false');

        const label = String.fromCharCode(65 + idx);
        button.innerHTML = `
          <span class="pill option-label" aria-hidden="true">${label}</span>
          <span>${optionText}</span>
        `;

        button.setAttribute('aria-label', `${label}ë²ˆ: ${optionText}`);
        button.addEventListener("click", () => selectAnswer(idx, button));
        elements.options.appendChild(button);
      });
    }

    function selectAnswer(choiceIdx, selectedButton) {
      if (gameState.locked) return;
      gameState.locked = true;

      const questionData = QUESTIONS[gameState.order[gameState.current]];
      const optionButtons = [...elements.options.children];
      const isCorrect = choiceIdx === questionData.answer;

      optionButtons.forEach((btn, idx) => {
        btn.classList.add("disabled");
        btn.setAttribute('aria-checked', 'false');

        if (idx === questionData.answer) {
          btn.classList.add("correct");
          btn.setAttribute('aria-label', btn.getAttribute('aria-label') + ' - ì •ë‹µ');
        }
        if (idx === choiceIdx && !isCorrect) {
          btn.classList.add("wrong");
          btn.setAttribute('aria-label', btn.getAttribute('aria-label') + ' - ì˜¤ë‹µ');
        }
      });

      selectedButton.setAttribute('aria-checked', 'true');

      if (isCorrect) {
        gameState.score += SCORE_PER_QUESTION;
        announceToScreenReader("ì •ë‹µì…ë‹ˆë‹¤!");
      } else {
        announceToScreenReader("ì˜¤ë‹µì…ë‹ˆë‹¤.");
      }

      updateUI();
      elements.nextBtn.disabled = false;
      elements.nextBtn.focus();
    }

    function nextQuestion() {
      if (gameState.current < gameState.order.length - 1) {
        gameState.current += 1;
        updateUI();
        renderQuestion();
      } else {
        finishQuiz();
      }
    }

    function skipQuestion() {
      if (gameState.locked) return;
      announceToScreenReader("ë¬¸ì œë¥¼ ê±´ë„ˆë›°ì—ˆìŠµë‹ˆë‹¤.");
      nextQuestion();
    }

    function finishQuiz() {
      elements.questionCard.style.display = "none";
      elements.result.style.display = "block";
      elements.progressBar.style.width = "100%";

      const ratio = gameState.score / gameState.order.length;
      let remark = "";

      if (ratio === PERFECT_SCORE_RATIO) {
        remark = "ì™„ë²½í•´ìš”! ë‹¹ì‹ ì€ ì§„ì •í•œ K-pop ë§ˆìŠ¤í„° ğŸ¤";
      } else if (ratio >= EXCELLENT_SCORE_RATIO) {
        remark = "ëŒ€ë‹¨í•´ìš”! ê±°ì˜ ë§ˆìŠ¤í„°ê¸‰ì´ì—ìš” âœ¨";
      } else if (ratio >= PASSING_SCORE_RATIO) {
        remark = "ì¢‹ì•„ìš”! ë” ì˜¬ë¼ê°ˆ ìˆ˜ ìˆì–´ìš” ğŸ’ª";
      } else {
        remark = "ê´œì°®ì•„ìš”â€”ë‹¤ìŒ ë¼ìš´ë“œì—ì„œ ë” ë‚˜ì•„ì§ˆ ê±°ì˜ˆìš” ğŸŒ±";
      }

      elements.finalText.textContent = `${gameState.order.length}ë¬¸ì œ ì¤‘ ${gameState.score}ë¬¸ì œ ì •ë‹µ. ${remark}`;
      elements.restartBtn.focus();
    }

    function announceToScreenReader(message) {
      const announcement = document.createElement('div');
      announcement.className = 'sr-only';
      announcement.setAttribute('role', 'status');
      announcement.setAttribute('aria-live', 'polite');
      announcement.textContent = message;
      document.body.appendChild(announcement);
      setTimeout(() => announcement.remove(), 1000);
    }

    // ì´ë²¤íŠ¸ ë“±ë¡
    elements.nextBtn.addEventListener("click", nextQuestion);
    elements.skipBtn.addEventListener("click", skipQuestion);
    elements.restartBtn.addEventListener("click", init);

    // ê²Œì„ ì‹œì‘
    loadQuestions();
  </script>
</body>

</html>
