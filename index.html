<!DOCTYPE html>

<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>K-pop Quiz Game - ë‹¹ì‹ ì€ K-pop ë§ˆìŠ¤í„°ì¸ê°€ìš”?</title>
  <meta name="description" content="BTS, BLACKPINK, NewJeans ë“± K-pop ì•„í‹°ìŠ¤íŠ¸ì— ëŒ€í•œ ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”! ì¬ë¯¸ìˆëŠ” K-pop í€´ì¦ˆ ê²Œì„.">
  <meta name="keywords" content="K-pop, í€´ì¦ˆ, BTS, BLACKPINK, NewJeans, ì¼€ì´íŒ, ê²Œì„">

  <meta property="og:type" content="website">
  <meta property="og:title" content="K-pop Quiz Game">
  <meta property="og:description" content="ë‹¹ì‹ ì˜ K-pop ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!">

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤</text></svg>">

  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --accent: #7c5cff;
      --accent-2: #ff5c9a;
      --text: #e9e9f1;
      --muted: #a9a9c7;
      --correct: #2ecc71;
      --wrong: #e74c3c;
      --easy: #4caf50;
      --medium: #ff9800;
      --hard: #f44336;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 600px at 20% 20%, #1b1f36 0%, var(--bg) 60%);
      color: var(--text);
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      padding: 20px 10px;
    }

    .container {
      width: min(720px, 100%);
      background: linear-gradient(180deg, rgba(124, 92, 255, 0.08), rgba(255, 92, 154, 0.08)), var(--card);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      position: relative;
      overflow: hidden;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .title {
      font-weight: 700;
      letter-spacing: 0.2px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
    }

    .title .badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(124, 92, 255, 0.18);
      color: #d9d6ff;
      border: 1px solid rgba(124, 92, 255, 0.35);
    }

    .meta {
      display: flex;
      gap: 10px;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      white-space: nowrap;
      font-weight: 600;
    }

    .stage-info {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--muted);
    }

    .stage-badge {
      padding: 4px 10px;
      border-radius: 6px;
      background: rgba(124, 92, 255, 0.15);
      border: 1px solid rgba(124, 92, 255, 0.3);
      font-weight: 600;
    }

    .question-card {
      margin-top: 8px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 18px;
    }

    .difficulty-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      margin-bottom: 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .difficulty-easy {
      background: rgba(76, 175, 80, 0.2);
      color: #81c784;
      border: 1px solid rgba(76, 175, 80, 0.4);
    }

    .difficulty-medium {
      background: rgba(255, 152, 0, 0.2);
      color: #ffb74d;
      border: 1px solid rgba(255, 152, 0, 0.4);
    }

    .difficulty-hard {
      background: rgba(244, 67, 54, 0.2);
      color: #e57373;
      border: 1px solid rgba(244, 67, 54, 0.4);
    }

    .question {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .option {
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      cursor: pointer;
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-family: inherit;
    }

    .option:hover:not(.disabled) {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.1);
    }

    .option:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .option.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    .option.correct {
      background: rgba(46, 204, 113, 0.15);
      border-color: rgba(46, 204, 113, 0.6);
      animation: correctPulse 0.5s ease;
    }

    .option.wrong {
      background: rgba(231, 76, 60, 0.15);
      border-color: rgba(231, 76, 60, 0.6);
      animation: shake 0.5s ease;
    }

    @keyframes correctPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.02);
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    .option-label {
      font-weight: 600;
      min-width: 24px;
    }

    .feedback {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.5;
      display: none;
    }

    .feedback.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .feedback.correct {
      background: rgba(46, 204, 113, 0.1);
      border: 1px solid rgba(46, 204, 113, 0.3);
      color: #5ce8a8;
    }

    .feedback.wrong {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      color: #ff8c82;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      gap: 10px;
    }

    .progress {
      height: 8px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .reset-btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: rgba(124, 92, 255, 0.15);
      color: #d9d6ff;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .reset-btn:hover {
      background: rgba(124, 92, 255, 0.25);
      transform: translateY(-1px);
    }

    .stage-clear,
    .end-screen {
      text-align: center;
      display: none;
    }

    .stage-clear.show,
    .end-screen.show {
      display: block;
    }

    /* ìƒˆë¡œìš´ Stage Clear í™”ë©´ ì „ìš© ìŠ¤íƒ€ì¼ */
    .stage-clear {
      padding: 30px;
      animation: fadeIn 0.5s ease;
    }

    .stage-clear-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .stage-clear-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin-bottom: 24px;
    }

    .stage-clear-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 20px;
      text-align: left;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-item-label {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .stat-item-value {
      font-size: 22px;
      font-weight: 600;
      color: var(--text);
    }

    .stat-item-value .small {
      font-size: 16px;
      font-weight: 400;
      color: var(--muted);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* --- */

    .final-score {
      font-size: 48px;
      font-weight: 700;
      margin: 20px 0;
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .score-message {
      font-size: 18px;
      color: var(--muted);
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 16px;
      }

      .title {
        font-size: 18px;
      }

      .question {
        font-size: 18px;
      }

      .option {
        font-size: 14px;
        padding: 10px 12px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="title">
        ğŸ¤ K-pop Quiz
        <span class="badge">2026</span>
      </div>
      <div class="meta">
        <span class="pill" id="score-display">ì ìˆ˜: 0 / 10,000</span>
      </div>
    </div>

    <div id="quiz-container">
      <div class="stage-info">
        <span class="stage-badge" id="stage-indicator">Stage 1</span>
        <span id="question-counter">Question 1 of 10</span>
      </div>

      <div class="question-card">
        <div class="difficulty-badge difficulty-easy" id="difficulty-badge">
          <span>â—</span>
          <span id="difficulty-text">EASY</span>
        </div>
        <div class="question" id="question">ë¡œë”© ì¤‘...</div>
        <div class="options" id="options">
          <div class="option disabled">ë¡œë”© ì¤‘...</div>
        </div>
        <div class="feedback" id="feedback"></div>
        <div class="footer">
          <span id="points-display">40pt</span>
        </div>
        <div class="progress">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>
    </div>

    <div class="stage-clear" id="stage-clear-screen">
      <h2 class="stage-clear-title" id="stage-clear-title">Stage 1 Clear!</h2>
      <p class="stage-clear-subtitle">ì ì‹œ í›„ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ê°€ ì‹œì‘ë©ë‹ˆë‹¤...</p>
      <div class="stage-clear-grid">
        <div class="stat-item">
          <div class="stat-item-label">ë§íŒ ë¬¸ì œ</div>
          <div class="stat-item-value" id="stage-clear-correct">0 <span class="small">/ 10</span></div>
        </div>
        <div class="stat-item">
          <div class="stat-item-label">Stage ì ìˆ˜</div>
          <div class="stat-item-value" id="stage-clear-score">0</div>
        </div>
        <div class="stat-item" style="grid-column: 1 / -1;">
          <div class="stat-item-label">ëˆ„ì  ì´ì </div>
          <div class="stat-item-value" id="stage-clear-total-score">0</div>
        </div>
      </div>
    </div>

    <div class="end-screen" id="end-screen">
      <h2>ğŸ‰ ê²Œì„ ì™„ë£Œ!</h2>
      <div class="final-score" id="final-score">0 / 10,000</div>
      <div class="score-message" id="score-message">ì •ë‹µì„ ë§ì¶°ë³´ì„¸ìš”!</div>
      <button class="reset-btn" id="restart-btn">ë‹¤ì‹œ ì‹œì‘ â†»</button>
    </div>
  </div>

  <script>
    // ==================== ì£¼ì„: 2ì°¨ ìˆ˜ì • (Stage Clear UX) ====================
    // 1. **Stage Clear ì „ìš© í™”ë©´**: ê¸°ì¡´ì˜ ê°„ë‹¨í•œ Stage ì™„ë£Œ í™”ë©´ì„, ìš”êµ¬ì‚¬í•­ì— ëª…ì‹œëœ
    //    ìƒì„¸ ì •ë³´(ë§íŒ ê°œìˆ˜, ìŠ¤í…Œì´ì§€ ì ìˆ˜, ëˆ„ì  ì´ì )ë¥¼ í‘œì‹œí•˜ëŠ” ìƒˆë¡œìš´ UIë¡œ êµì²´í–ˆìŠµë‹ˆë‹¤.
    //    (HTML: stage-result -> stage-clear-screen, CSS: .stage-clear ì¶”ê°€)
    //
    // 2. **ì •ë‹µ ìˆ˜ ì¶”ì **: `gameState` ê°ì²´ì— `stageCorrectAnswers`ë¥¼ ì¶”ê°€í•˜ì—¬,
    //    ìŠ¤í…Œì´ì§€ ë‚´ì—ì„œ ë§íŒ ë¬¸ì œ ìˆ˜ë¥¼ ì •í™•íˆ ì¶”ì í•©ë‹ˆë‹¤. ì´ ê°’ì€ ìƒˆ ìŠ¤í…Œì´ì§€ê°€ ì‹œì‘ë  ë•Œë§ˆë‹¤ 0ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
    //
    // 3. **Stage Clear ë¡œì§ ë¶„ë¦¬**: ê¸°ì¡´ `showStageResult` í•¨ìˆ˜ë¥¼ `showStageClearScreen` í•¨ìˆ˜ë¡œ
    //    ê°œì„  ë° ë³€ê²½í–ˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ê³„ì‚°ëœ í†µê³„ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ê³ , 2ì´ˆ í›„ì— ìë™ìœ¼ë¡œ
    //    ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ì—­í• ì„ ëª…í™•íˆ ë‹´ë‹¹í•©ë‹ˆë‹¤.
    // =================================================================

    // ==================== DOM ìš”ì†Œ ====================
    const quizContainer = document.getElementById('quiz-container');
    const stageClearScreenEl = document.getElementById('stage-clear-screen'); // ID ë³€ê²½
    const endScreenEl = document.getElementById('end-screen');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    const restartBtn = document.getElementById('restart-btn');
    const scoreDisplayEl = document.getElementById('score-display');
    const pointsDisplayEl = document.getElementById('points-display');
    const stageIndicator = document.getElementById('stage-indicator');
    const questionCounter = document.getElementById('question-counter');
    const difficultyBadge = document.getElementById('difficulty-badge');
    const difficultyText = document.getElementById('difficulty-text');
    const progressBar = document.getElementById('progress-bar');

    // Stage Clear í™”ë©´ì˜ DOM ìš”ì†Œë“¤
    const stageClearTitleEl = document.getElementById('stage-clear-title');
    const stageClearCorrectEl = document.getElementById('stage-clear-correct');
    const stageClearScoreEl = document.getElementById('stage-clear-score');
    const stageClearTotalScoreEl = document.getElementById('stage-clear-total-score');

    const finalScoreEl = document.getElementById('final-score');
    const scoreMessageEl = document.getElementById('score-message');

    // ==================== ê²Œì„ ìƒíƒœ ê´€ë¦¬ ====================
    const QUESTIONS_PER_STAGE = 10;
    const API_URL = ''; // ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©

    const gameState = {
      currentStage: 1,
      questionIndex: 0,
      totalScore: 0,
      stageScore: 0,
      stageCorrectAnswers: 0, // ìˆ˜ì •: ìŠ¤í…Œì´ì§€ ì •ë‹µ ìˆ˜ ì¶”ì 
      currentQuestions: [],
      isAnswered: false,
    };

    // ==================== í•µì‹¬ ê²Œì„ ë¡œì§ ====================

    /** ê²Œì„ ì‹œì‘ */
    function startGame() {
      gameState.currentStage = 1;
      gameState.totalScore = 0;
      endScreenEl.classList.remove('show');
      stageClearScreenEl.classList.remove('show');
      quizContainer.style.display = 'block';
      updateScoreDisplay();
      loadStage(gameState.currentStage);
    }

    /** ìŠ¤í…Œì´ì§€ ë°ì´í„° ë¡œë“œ */
    async function loadStage(stageNum) {
      try {
        quizContainer.style.display = 'block';
        stageClearScreenEl.classList.remove('show');
        questionEl.textContent = `Stage ${stageNum} ë¡œë”© ì¤‘...`;
        optionsEl.innerHTML = '<div class="option disabled">...</div>';

        let stageData = [];

        // ì •ì  í˜¸ìŠ¤íŒ… í™˜ê²½ ê°ì§€ (GitHub Pages, Live Server í¬íŠ¸ 5500~5599, íŒŒì¼ í”„ë¡œí† ì½œ)
        const isStaticHost = window.location.hostname.includes('github.io') ||
          (window.location.port >= 5500 && window.location.port <= 5599) ||
          window.location.protocol === 'file:';

        if (isStaticHost) {
          // === ì •ì  ëª¨ë“œ: questions.json ì§ì ‘ ë¡œë“œ ===
          if (!gameState.allStaticQuestions || gameState.allStaticQuestions.length === 0) {
            const response = await fetch('questions.json');
            if (!response.ok) throw new Error(`JSON ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
            const data = await response.json();

            // ë°ì´í„° ë³€í™˜ ë° í‰íƒ„í™”
            let allQ = [];
            const categories = ['artist', 'song', 'general'];
            const pointsMap = { 'easy': 40, 'medium': 81, 'hard': 122 };

            categories.forEach(cat => {
              if (data.categories[cat]) {
                data.categories[cat].forEach(q => {
                  allQ.push({
                    id: q.id,
                    question: q.question,
                    difficulty: q.difficulty || 'easy',
                    points: pointsMap[q.difficulty] || 40,
                    category: cat,
                    explanation: q.explanation || '',
                    options: q.options.map((txt, idx) => ({
                      id: idx,
                      option_text: txt,
                      order_num: idx,
                      is_correct: idx === q.answer
                    }))
                  });
                });
              }
            });

            // ì „ì²´ ë¬¸ì œ ëœë¤ ì„ê¸° (ìµœì´ˆ 1íšŒ)
            allQ.sort(() => Math.random() - 0.5);
            gameState.allStaticQuestions = allQ;
          }

          // í˜„ì¬ ìŠ¤í…Œì´ì§€ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œ 10ê°œ ì¶”ì¶œ
          const startIdx = (stageNum - 1) * QUESTIONS_PER_STAGE;
          stageData = gameState.allStaticQuestions.slice(startIdx, startIdx + QUESTIONS_PER_STAGE);

          // ë¬¸ì œê°€ ì—†ìœ¼ë©´(ëª¨ë“  ë¬¸ì œ ì†Œì§„) ê²Œì„ ì¢…ë£Œ
          if (stageData.length === 0) {
            showEndScreen();
            return;
          }

        } else {
          // === API ëª¨ë“œ: Flask ì„œë²„ í˜¸ì¶œ ===
          const response = await fetch(`${API_URL}/api/quiz?stage=${stageNum}`);
          if (!response.ok) {
            throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
          }

          const result = await response.json();

          if (result.end_of_quiz === true || !result.data || result.data.length === 0) {
            showEndScreen();
            return;
          }
          stageData = result.data;
        }

        // ê³µí†µ: ìŠ¤í…Œì´ì§€ ìƒíƒœ ì´ˆê¸°í™”
        gameState.currentQuestions = stageData;
        gameState.questionIndex = 0;
        gameState.stageScore = 0;
        gameState.stageCorrectAnswers = 0;
        gameState.currentStage = stageNum;

        stageIndicator.textContent = `Stage ${stageNum}`;
        displayQuestion();

      } catch (error) {
        console.error(`Stage ${stageNum} ë¡œë“œ ì‹¤íŒ¨:`, error);
        questionEl.innerHTML = `
                  <div style="text-align: center; color: var(--wrong); padding: 20px;">
                      <h3>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                      <p>${error.message}</p>
                      <p style="font-size: 0.8em; margin-top: 10px; opacity: 0.8;">
                          ${window.location.hostname.includes('github.io') ? 'ìƒˆë¡œê³ ì¹¨ì„ í•´ë³´ì„¸ìš”.' : 'ë¡œì»¬ ì„œë²„(python run_server.py)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.'}
                      </p>
                  </div>`;
      }
    }

    /** ë¬¸ì œ í‘œì‹œ */
    function displayQuestion() {
      // ... (ì´ í•¨ìˆ˜ëŠ” ë³€ê²½ ì—†ìŒ) ...
      gameState.isAnswered = false;
      const question = gameState.currentQuestions[gameState.questionIndex];

      if (!question) {
        console.error('í‘œì‹œí•  ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.', gameState);
        return;
      }

      feedbackEl.className = 'feedback';
      feedbackEl.textContent = '';

      questionEl.textContent = question.question;

      const difficulty = question.difficulty || 'easy';
      difficultyBadge.className = `difficulty-badge difficulty-${difficulty.toLowerCase()}`;
      difficultyText.textContent = difficulty.toUpperCase();

      pointsDisplayEl.textContent = `${question.points}pt`;
      pointsDisplayEl.style.color = 'var(--muted)';

      optionsEl.innerHTML = '';
      question.options.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.innerHTML = `<span class="option-label">${String.fromCharCode(65 + index)}.</span>${option.option_text}`;
        btn.addEventListener('click', () => handleAnswer(option));
        optionsEl.appendChild(btn);
      });

      questionCounter.textContent = `Question ${gameState.questionIndex + 1} of ${QUESTIONS_PER_STAGE}`;
      progressBar.style.width = `${((gameState.questionIndex + 1) / QUESTIONS_PER_STAGE) * 100}%`;
    }

    /** ë‹µë³€ ì²˜ë¦¬ ë° ìë™ ì „í™˜ */
    function handleAnswer(selectedOption) {
      if (gameState.isAnswered) return;
      gameState.isAnswered = true;

      const question = gameState.currentQuestions[gameState.questionIndex];
      const correctOption = question.options.find(opt => opt.is_correct);
      const isCorrect = selectedOption.id === correctOption.id;

      document.querySelectorAll('.option').forEach(btn => {
        btn.classList.add('disabled');
        const btnText = btn.innerHTML;
        if (isCorrect && btnText.includes(selectedOption.option_text)) {
          btn.classList.add('correct');
        } else if (!isCorrect && btnText.includes(selectedOption.option_text)) {
          btn.classList.add('wrong');
        }
        if (!isCorrect && btnText.includes(correctOption.option_text)) {
          btn.classList.add('correct');
        }
      });

      if (isCorrect) {
        const points = question.points;
        gameState.totalScore += points;
        gameState.stageScore += points;
        gameState.stageCorrectAnswers++; // ìˆ˜ì •: ì •ë‹µ ìˆ˜ ì¹´ìš´íŠ¸
        feedbackEl.className = 'feedback show correct';
        feedbackEl.textContent = `ì •ë‹µ! +${points}pt. ${question.explanation || ''}`;
      } else {
        feedbackEl.className = 'feedback show wrong';
        feedbackEl.textContent = `í‹€ë ¸ìŠµë‹ˆë‹¤. ${question.explanation || ''}`;
      }

      updateScoreDisplay();
      setTimeout(nextStep, isCorrect ? 800 : 1200);
    }

    /** ë‹¤ìŒ ë¬¸ì œ ë˜ëŠ” ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ í™”ë©´ìœ¼ë¡œ ì´ë™ */
    function nextStep() {
      gameState.questionIndex++;
      // ìˆ˜ì •: ìŠ¤í…Œì´ì§€ì˜ ë§ˆì§€ë§‰ ë¬¸ì œì¸ì§€ í™•ì¸
      if (gameState.questionIndex < gameState.currentQuestions.length) {
        displayQuestion();
      } else {
        showStageClearScreen(); // ìˆ˜ì •: Stage Clear í™”ë©´ í˜¸ì¶œ
      }
    }

    /** ì ìˆ˜íŒ ì—…ë°ì´íŠ¸ */
    function updateScoreDisplay() {
      scoreDisplayEl.textContent = `ì ìˆ˜: ${gameState.totalScore.toLocaleString()} / 10,000`;
    }

    /** Stage Clear í™”ë©´ í‘œì‹œ ë° ìë™ ì „í™˜ (ìˆ˜ì •ëœ í•¨ìˆ˜) */
    function showStageClearScreen() {
      quizContainer.style.display = 'none';
      stageClearScreenEl.classList.add('show');

      // ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ì •ë³´ ì—…ë°ì´íŠ¸
      stageClearTitleEl.textContent = `Stage ${gameState.currentStage} Clear!`;
      stageClearCorrectEl.innerHTML = `${gameState.stageCorrectAnswers} <span class="small">/ ${QUESTIONS_PER_STAGE}</span>`;
      stageClearScoreEl.textContent = gameState.stageScore.toLocaleString();
      stageClearTotalScoreEl.textContent = gameState.totalScore.toLocaleString();

      // 2ì´ˆ í›„ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ìë™ ì‹œì‘
      setTimeout(() => {
        loadStage(gameState.currentStage + 1);
      }, 2000);
    }

    /** ìµœì¢… ê²°ê³¼ í‘œì‹œ */
    function showEndScreen() {
      // ... (ì´ í•¨ìˆ˜ëŠ” ë³€ê²½ ì—†ìŒ) ...
      quizContainer.style.display = 'none';
      stageClearScreenEl.classList.remove('show');
      endScreenEl.classList.add('show');

      finalScoreEl.textContent = `${gameState.totalScore.toLocaleString()} / 10,000`;

      const percentage = (gameState.totalScore / 10000) * 100;
      if (percentage >= 90) scoreMessageEl.textContent = 'ì™„ë²½í•´ìš”! ë‹¹ì‹ ì€ K-pop ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤!';
      else if (percentage >= 70) scoreMessageEl.textContent = 'í›Œë¥­í•´ìš”! ê±°ì˜ ë§ˆìŠ¤í„° ìˆ˜ì¤€!';
      else if (percentage >= 50) scoreMessageEl.textContent = 'ì˜í–ˆì–´ìš”! K-pop ì „ë¬¸ê°€ë¥¼ í–¥í•´!';
      else scoreMessageEl.textContent = 'ë‹¤ì‹œ ë„ì „í•´ì„œ K-pop ì§€ì‹ì„ ë„“í˜€ë³´ì„¸ìš”!';
    }

    // ==================== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ====================
    restartBtn.addEventListener('click', startGame);

    // ==================== ì´ˆê¸°í™” ====================
    document.addEventListener('DOMContentLoaded', startGame);
  </script>
</body>

</html>