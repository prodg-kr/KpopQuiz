<!DOCTYPE html>

<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>K-pop Quiz Game - ë‹¹ì‹ ì€ K-pop ë§ˆìŠ¤í„°ì¸ê°€ìš”?</title>
  <meta name="description" content="BTS, BLACKPINK, NewJeans ë“± K-pop ì•„í‹°ìŠ¤íŠ¸ì— ëŒ€í•œ ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”! ì¬ë¯¸ìˆëŠ” K-pop í€´ì¦ˆ ê²Œì„.">
  <meta name="keywords" content="K-pop, í€´ì¦ˆ, BTS, BLACKPINK, NewJeans, ì¼€ì´íŒ, ê²Œì„">

  <meta property="og:type" content="website">
  <meta property="og:title" content="K-pop Quiz Game">
  <meta property="og:description" content="ë‹¹ì‹ ì˜ K-pop ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!">

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤</text></svg>">

  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --accent: #7c5cff;
      --accent-2: #ff5c9a;
      --text: #e9e9f1;
      --muted: #a9a9c7;
      --correct: #2ecc71;
      --wrong: #e74c3c;
      --easy: #4caf50;
      --medium: #ff9800;
      --hard: #f44336;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 600px at 20% 20%, #1b1f36 0%, var(--bg) 60%);
      color: var(--text);
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      padding: 20px 10px;
    }

    .container {
      width: min(720px, 100%);
      background: linear-gradient(180deg, rgba(124, 92, 255, 0.08), rgba(255, 92, 154, 0.08)), var(--card);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      position: relative;
      overflow: hidden;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .title {
      font-weight: 700;
      letter-spacing: 0.2px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
    }

    .title .badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(124, 92, 255, 0.18);
      color: #d9d6ff;
      border: 1px solid rgba(124, 92, 255, 0.35);
    }

    .meta {
      display: flex;
      gap: 10px;
      align-items: center;
      color: var(--muted);
      font-size: 14px;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      white-space: nowrap;
      font-weight: 600;
    }

    .stage-info {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--muted);
    }

    .stage-badge {
      padding: 4px 10px;
      border-radius: 6px;
      background: rgba(124, 92, 255, 0.15);
      border: 1px solid rgba(124, 92, 255, 0.3);
      font-weight: 600;
    }

    .question-card {
      margin-top: 8px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 18px;
    }

    .difficulty-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      margin-bottom: 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .difficulty-easy {
      background: rgba(76, 175, 80, 0.2);
      color: #81c784;
      border: 1px solid rgba(76, 175, 80, 0.4);
    }

    .difficulty-medium {
      background: rgba(255, 152, 0, 0.2);
      color: #ffb74d;
      border: 1px solid rgba(255, 152, 0, 0.4);
    }

    .difficulty-hard {
      background: rgba(244, 67, 54, 0.2);
      color: #e57373;
      border: 1px solid rgba(244, 67, 54, 0.4);
    }

    .question {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .option {
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      cursor: pointer;
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-family: inherit;
    }

    .option:hover:not(.disabled) {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.1);
    }

    .option:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .option.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    .option.correct {
      background: rgba(46, 204, 113, 0.15);
      border-color: rgba(46, 204, 113, 0.6);
      animation: correctPulse 0.5s ease;
    }

    .option.wrong {
      background: rgba(231, 76, 60, 0.15);
      border-color: rgba(231, 76, 60, 0.6);
      animation: shake 0.5s ease;
    }

    @keyframes correctPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.02);
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    .option-label {
      font-weight: 600;
      min-width: 24px;
    }

    .feedback {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.5;
      display: none;
    }

    .feedback.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .feedback.correct {
      background: rgba(46, 204, 113, 0.1);
      border: 1px solid rgba(46, 204, 113, 0.3);
      color: #5ce8a8;
    }

    .feedback.wrong {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      color: #ff8c82;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      gap: 10px;
    }

    .progress {
      height: 8px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .reset-btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: rgba(124, 92, 255, 0.15);
      color: #d9d6ff;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .reset-btn:hover {
      background: rgba(124, 92, 255, 0.25);
      transform: translateY(-1px);
    }

    .stage-result,
    .end-screen {
      text-align: center;
      display: none;
    }

    .stage-result.show,
    .end-screen.show {
      display: block;
    }

    .final-score {
      font-size: 48px;
      font-weight: 700;
      margin: 20px 0;
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .score-message {
      font-size: 18px;
      color: var(--muted);
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 16px;
      }

      .title {
        font-size: 18px;
      }

      .question {
        font-size: 18px;
      }

      .option {
        font-size: 14px;
        padding: 10px 12px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="title">
        ğŸ¤ K-pop Quiz
        <span class="badge">2026</span>
      </div>
      <div class="meta">
        <span class="pill" id="score-display">ì ìˆ˜: 0 / 10,000</span>
      </div>
    </div>

    <div id="quiz-container">
      <div class="stage-info">
        <span class="stage-badge" id="stage-indicator">Stage 1</span>
        <span id="question-counter">Question 1 of 10</span>
      </div>

      <div class="question-card">
        <div class="difficulty-badge difficulty-easy" id="difficulty-badge">
          <span>â—</span>
          <span id="difficulty-text">EASY</span>
        </div>
        <div class="question" id="question">ë¡œë”© ì¤‘...</div>
        <div class="options" id="options">
          <div class="option disabled">ë¡œë”© ì¤‘...</div>
        </div>
        <div class="feedback" id="feedback"></div>
        <div class="footer">
          <span id="points-display">40pt</span>
        </div>
        <div class="progress">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>
    </div>

    <div class="stage-result" id="stage-result">
      <h2>ğŸ¯ Stage ì™„ë£Œ!</h2>
      <div class="final-score" id="stage-score">0 / 1,000</div>
      <div class="score-message" id="stage-message">ë‹¤ìŒ Stageë¡œ ê³„ì†í•˜ì„¸ìš”!</div>
      <button class="reset-btn" id="next-stage-btn">Next Stage â†’</button>
    </div>

    <div class="end-screen" id="end-screen">
      <h2>ğŸ‰ ê²Œì„ ì™„ë£Œ!</h2>
      <div class="final-score" id="final-score">0 / 10,000</div>
      <div class="score-message" id="score-message">ì •ë‹µì„ ë§ì¶°ë³´ì„¸ìš”!</div>
      <button class="reset-btn" id="restart-btn">ë‹¤ì‹œ ì‹œì‘ â†»</button>
    </div>
  </div>

  <script>
    // ==================== DOM ìš”ì†Œ ====================
    const quizContainer = document.getElementById('quiz-container');
    const stageResult = document.getElementById('stage-result');
    const endScreen = document.getElementById('end-screen');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    const restartBtn = document.getElementById('restart-btn');
    const nextStageBtn = document.getElementById('next-stage-btn');
    const scoreDisplayEl = document.getElementById('score-display');
    const pointsDisplayEl = document.getElementById('points-display');
    const stageIndicator = document.getElementById('stage-indicator');
    const questionCounter = document.getElementById('question-counter');
    const difficultyBadge = document.getElementById('difficulty-badge');
    const difficultyText = document.getElementById('difficulty-text');
    const progressBar = document.getElementById('progress-bar');
    const stageScoreEl = document.getElementById('stage-score');
    const stageMessageEl = document.getElementById('stage-message');
    const finalScoreEl = document.getElementById('final-score');
    const scoreMessageEl = document.getElementById('score-message');

    // ==================== ê²Œì„ ìƒíƒœ ====================
    const QUESTIONS_PER_STAGE = 10;
    let allQuestions = [];
    let currentStage = 1;
    let questionIndexInStage = 0;
    let totalScore = 0;
    let stageScore = 0;
    let answered = false;

    // API ì„œë²„ URL
    const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:5000'
      : window.location.origin;

    // ==================== ë°ì´í„° ë¡œë“œ ====================
    async function loadQuizData() {
      try {
        questionEl.textContent = 'ë°ì´í„° ë¡œë“œ ì¤‘...';

        let loadedQuestions = [];

        // GitHub Pages ë˜ëŠ” ì •ì  í˜¸ìŠ¤íŒ…: questions.json ì§ì ‘ ë¡œë“œ
        if (window.location.hostname.includes('github.io') || window.location.protocol === 'file:') {
          const response = await fetch('./questions.json');
          if (!response.ok) throw new Error(`JSON ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);

          const data = await response.json();

          // JSON í˜•ì‹ì„ API í˜•ì‹ìœ¼ë¡œ ë³€í™˜
          const categories = ['artist', 'song', 'general'];
          categories.forEach(category => {
            if (data.categories && data.categories[category]) {
              data.categories[category].forEach(q => {
                // ë‚œì´ë„ë³„ ì ìˆ˜ í• ë‹¹
                const pointsMap = { 'easy': 40, 'medium': 81, 'hard': 122 };
                const points = pointsMap[q.difficulty] || 40;

                loadedQuestions.push({
                  id: q.id,
                  question: q.question,
                  difficulty: q.difficulty || 'easy',
                  points: points,
                  is_active: true,
                  category: category,
                  explanation: q.explanation || '',
                  options: q.options.map((text, idx) => ({
                    id: idx,
                    option_text: text,
                    order_num: idx,
                    is_correct: idx === q.answer
                  }))
                });
              });
            }
          });

          // ëœë¤ ì…”í”Œ (ì •ì  ëª¨ë“œì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ì…”í”Œ í•„ìš”)
          loadedQuestions.sort(() => Math.random() - 0.5);

        } else {
          // ë¡œì»¬ ê°œë°œ: API ì‚¬ìš©
          const response = await fetch(`${API_URL}/api/quiz?limit=200`);
          if (!response.ok) throw new Error(`API ì˜¤ë¥˜: ${response.status}`);

          const result = await response.json();
          if (!result.success) throw new Error(result.error || 'API ì‘ë‹µ ì˜¤ë¥˜');

          loadedQuestions = result.data || [];
        }

        allQuestions = loadedQuestions;
        if (allQuestions.length === 0) throw new Error('í™œì„± ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');

        console.log(`${allQuestions.length}ê°œ ë¬¸ì œ ë¡œë“œ ì™„ë£Œ`);
        startStage();
      } catch (error) {
        console.error('í€´ì¦ˆ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        questionEl.innerHTML = `
          <div style="text-align: center; padding: 30px; color: var(--wrong);">
            <h2>ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h2>
            <p>${error.message}</p>
            <p style="font-size: 14px; margin-top: 15px;">
              ${window.location.hostname.includes('github.io') ?
            'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' :
            'ë¡œì»¬ ì„œë²„ ì‹¤í–‰: python run_server.py'}
            </p>
          </div>
        `;
      }
    }

    // ==================== Stage ì‹œì‘ ====================
    function startStage() {
      questionIndexInStage = 0;
      stageScore = 0;
      quizContainer.style.display = 'block';
      stageResult.classList.remove('show');
      endScreen.classList.remove('show');

      stageIndicator.textContent = `Stage ${currentStage}`;
      displayQuestion();
    }

    // ==================== ë¬¸ì œ í‘œì‹œ ====================
    function displayQuestion() {
      const globalIndex = (currentStage - 1) * QUESTIONS_PER_STAGE + questionIndexInStage;

      if (globalIndex >= allQuestions.length) {
        showEndScreen();
        return;
      }

      if (questionIndexInStage >= QUESTIONS_PER_STAGE) {
        showStageResult();
        return;
      }

      answered = false;
      const question = allQuestions[globalIndex];

      // ë¬¸ì œ í…ìŠ¤íŠ¸
      questionEl.textContent = question.question;

      // ë‚œì´ë„ í‘œì‹œ
      const difficulty = question.difficulty || 'easy';
      difficultyBadge.className = `difficulty-badge difficulty-${difficulty}`;
      difficultyText.textContent = difficulty.toUpperCase();

      // ì ìˆ˜ í‘œì‹œ
      const points = question.points || 40;
      pointsDisplayEl.textContent = `${points}pt`;
      pointsDisplayEl.style.color = difficulty === 'hard' ? '#e57373' : difficulty === 'medium' ? '#ffb74d' : '#81c784';

      // ì„ íƒì§€ ìƒì„±
      optionsEl.innerHTML = '';
      let correctOptionIndex = -1;
      const sortedOptions = question.options.sort((a, b) => a.order_num - b.order_num);

      sortedOptions.forEach((option, index) => {
        if (option.is_correct) correctOptionIndex = index;
      });

      sortedOptions.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.innerHTML = `<span class="option-label">${String.fromCharCode(65 + index)}.</span>${option.option_text}`;
        btn.addEventListener('click', () => checkAnswer(index, correctOptionIndex, question.points || 40, question.explanation));
        optionsEl.appendChild(btn);
      });

      // ì§„í–‰ ìƒí™©
      questionCounter.textContent = `Question ${questionIndexInStage + 1} of ${QUESTIONS_PER_STAGE}`;
      const progressPercent = ((questionIndexInStage + 1) / QUESTIONS_PER_STAGE) * 100;
      progressBar.style.width = progressPercent + '%';

      // ì ìˆ˜ í‘œì‹œ
      scoreDisplayEl.textContent = `ì ìˆ˜: ${totalScore.toLocaleString()} / 10,000`;

      feedbackEl.className = 'feedback';
      feedbackEl.textContent = '';
    }

    // ==================== ë‹µë³€ í™•ì¸ ====================
    function checkAnswer(selectedIndex, correctIndex, points, explanation) {
      if (answered) return;
      answered = true;

      const isCorrect = selectedIndex === correctIndex;

      // UI ì—…ë°ì´íŠ¸
      const options = document.querySelectorAll('.option');
      options.forEach((option, index) => {
        option.classList.add('disabled');
        if (index === correctIndex) option.classList.add('correct');
        if (index === selectedIndex && !isCorrect) option.classList.add('wrong');
      });

      // ì ìˆ˜ ì ìš©
      if (isCorrect) {
        totalScore += points;
        stageScore += points;
        feedbackEl.className = 'feedback show correct';
        feedbackEl.textContent = `ì •ë‹µ! +${points}pt ` + (explanation || '');
      } else {
        feedbackEl.className = 'feedback show wrong';
        feedbackEl.textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤. ' + (explanation || '');
      }

      scoreDisplayEl.textContent = `ì ìˆ˜: ${totalScore.toLocaleString()} / 10,000`;

      // ìë™ ì „í™˜
      const delay = isCorrect ? 1000 : 1200;
      setTimeout(() => {
        questionIndexInStage++;
        displayQuestion();
      }, delay);
    }

    // ==================== Stage ê²°ê³¼ ====================
    function showStageResult() {
      quizContainer.style.display = 'none';
      stageResult.classList.add('show');

      // Stageë³„ ìµœëŒ€ ì ìˆ˜ ê³„ì‚° (ëŒ€ëµ)
      const maxStagePoints = Math.round(10000 / Math.ceil(allQuestions.length / QUESTIONS_PER_STAGE));
      stageScoreEl.textContent = `${stageScore.toLocaleString()} / ~${maxStagePoints.toLocaleString()}`;

      const percentage = (stageScore / maxStagePoints) * 100;
      if (percentage >= 80) {
        stageMessageEl.textContent = 'í›Œë¥­í•´ìš”! ë‹¤ìŒ Stageë¡œ!';
      } else if (percentage >= 60) {
        stageMessageEl.textContent = 'ì˜í–ˆì–´ìš”! ê³„ì† ë„ì „!';
      } else {
        stageMessageEl.textContent = 'ë‹¤ìŒ Stageì—ì„œ ë” ì˜í•  ìˆ˜ ìˆì–´ìš”!';
      }
    }

    // ==================== ìµœì¢… ê²°ê³¼ ====================
    function showEndScreen() {
      quizContainer.style.display = 'none';
      stageResult.classList.remove('show');
      endScreen.classList.add('show');

      finalScoreEl.textContent = `${totalScore.toLocaleString()} / 10,000`;

      const percentage = (totalScore / 10000) * 100;
      if (percentage >= 90) {
        scoreMessageEl.textContent = 'ì™„ë²½í•´ìš”! K-pop ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤!';
      } else if (percentage >= 70) {
        scoreMessageEl.textContent = 'í›Œë¥­í•´ìš”! ê±°ì˜ ë§ˆìŠ¤í„° ìˆ˜ì¤€!';
      } else if (percentage >= 50) {
        scoreMessageEl.textContent = 'ì˜í–ˆì–´ìš”! ë” ì•Œì•„ë³´ì„¸ìš”!';
      } else {
        scoreMessageEl.textContent = 'ê³„ì† ë„ì „í•´ë³´ì„¸ìš”!';
      }
    }

    // ==================== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ====================
    nextStageBtn.addEventListener('click', () => {
      currentStage++;
      startStage();
    });

    restartBtn.addEventListener('click', () => {
      currentStage = 1;
      totalScore = 0;
      loadQuizData();
    });

    // ==================== ì´ˆê¸°í™” ====================
    loadQuizData();
  </script>
</body>

</html>